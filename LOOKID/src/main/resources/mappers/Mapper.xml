<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="lookid.server.dao.Mapper">

	<!-- 로그아웃은 서비스에서 제거 -->

	<select id="checkId" resultType="Integer">

		select user_pid from user where
		id=#{id}

	</select>

	<!-- phone이 db에 이미 존재한다면 insert를 하지 않는다 -->
	<insert id="signup">

		insert into
		user(id,pw,name,phone,mail,address,bank_name,bank_num,bank_holder)
		select
		#{id},#{pw},#{name},#{phone},#{mail},#{address},#{bank_name},#{bank_num},#{bank_holder}
		from dual
		where
		not exists (
		select user_pid
		from user
		where phone =
		#{phone}
		)
		LIMIT 1

	</insert>

	<!-- user_pid select -->
	<select id="signin" resultType="lookid.server.vo.UserVO">

		select * from user where id=#{id}
		and pw=#{pw}

	</select>

	<select id="find_id" resultType="lookid.server.dto.FindIdDTO">

		select * from user where
		name=#{name} and phone=#{phone}

	</select>

	<select id="find_pw" resultType="String">

		select mail from user where
		id=#{id} and mail=#{mail}

	</select>

	<!-- 랜덤스트링 임시비밀번호로 db update -->
	<update id="modify_temp_pw">

		update user set pw=#{pw} where mail=#{mail} and id=#{id}

	</update>

	<select id="find_admin"
		resultType="lookid.server.dto.FindAdminDTO">
		select * from user where id=#{id}
	</select>


	<!-- jwt 필요 -->
	<update id="modify_pw">

		update user set pw=#{pw} where user_pid=#{user_pid}

	</update>

	<!-- jwt 구현 전까지는 id를 조건으로 임시지정 구현후 토큰을 통해 user_pid를 알아내어 조건을 user_pid로 sql문작성 -->
	<update id="modify">
		update user set
		pw=#{pw},name=#{name},phone=#{phone},mail=#{mail},address=#{address},bank_name=#{bank_name},bank_num=#{bank_num},bank_holder=#{bank_holder}
		where user_pid=#{user_pid}
	</update>

	<!-- 튜플 개수 카운트 -->
	<select id="count" resultType="Integer">
		select count(*) from user
	</select>


</mapper>